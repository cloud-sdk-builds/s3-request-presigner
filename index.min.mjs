var e=function(){return e=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},e.apply(this,arguments)};function r(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)r.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(t[n[i]]=e[n[i]])}return t}function t(e,r,t,n){return new(t||(t=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(a,s)}u((n=n.apply(e,r||[])).next())})}function n(e,r){var t,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=r.call(e,a)}catch(e){o=[6,e],n=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function i(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,i,o=t.call(e),a=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return a}function a(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(o(arguments[r]));return e}var s="X-Amz-Date",u="X-Amz-Signature",c="X-Amz-Security-Token",l="authorization",h=s.toLowerCase(),f=[l,h,"date"],d=u.toLowerCase(),v="x-amz-content-sha256",p=c.toLowerCase(),y={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},g=/^proxy-/,b=/^sec-/,w="AWS4-HMAC-SHA256",m="AWS4-HMAC-SHA256-PAYLOAD",S="aws4_request",A={},x=[];function j(e,r,t){return e+"/"+r+"/"+t+"/"+S}for(var k={},O={},q=0;q<256;q++){var C=q.toString(16).toLowerCase();1===C.length&&(C="0"+C),k[q]=C,O[C]=q}function P(e){for(var r="",t=0;t<e.byteLength;t++)r+=k[e[t]];return r}function D(e,r,t){var n,o,a=e.headers,s={};try{for(var u=i(Object.keys(a).sort()),c=u.next();!c.done;c=u.next()){var l=c.value,h=l.toLowerCase();(h in y||(null==r?void 0:r.has(h))||g.test(h)||b.test(h))&&(!t||t&&!t.has(h))||(s[h]=a[l].trim().replace(/\s+/g," "))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}return s}var H=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,L)},L=function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()};function R(e,r){var o=e.headers,a=e.body;return t(this,void 0,void 0,function(){var e,t,s,u,c,l,h;return n(this,function(n){switch(n.label){case 0:try{for(e=i(Object.keys(o)),t=e.next();!t.done;t=e.next())if((s=t.value).toLowerCase()===v)return[2,o[s]]}catch(e){l={error:e}}finally{try{t&&!t.done&&(h=e.return)&&h.call(e)}finally{if(l)throw l.error}}return null!=a?[3,1]:[2,"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"];case 1:return"string"==typeof a||ArrayBuffer.isView(a)||(f=a,"function"==typeof ArrayBuffer&&f instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(f))?((u=new r).update(a),c=P,[4,u.digest()]):[3,3];case 2:return[2,c.apply(void 0,[n.sent()])];case 3:return[2,"UNSIGNED-PAYLOAD"]}var f})})}function z(t){var n=t.headers,i=t.query,o=r(t,["headers","query"]);return e(e({},o),{headers:e({},n),query:i?E(i):void 0})}function E(r){return Object.keys(r).reduce(function(t,n){var i,o=r[n];return e(e({},t),((i={})[n]=Array.isArray(o)?a(o):o,i))},{})}function I(e){var r,t;e="function"==typeof e.clone?e.clone():z(e);try{for(var n=i(Object.keys(e.headers)),o=n.next();!o.done;o=n.next()){var a=o.value;f.indexOf(a.toLowerCase())>-1&&delete e.headers[a]}}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}return e}var T=function(){function r(e){var r=e.applyChecksum,t=e.credentials,n=e.region,i=e.service,o=e.sha256,a=e.uriEscapePath,s=void 0===a||a;this.service=i,this.sha256=o,this.uriEscapePath=s,this.applyChecksum="boolean"!=typeof r||r,this.regionProvider=N(n),this.credentialProvider=M(t)}return r.prototype.presign=function(r,o){return void 0===o&&(o={}),t(this,void 0,void 0,function(){var t,a,l,h,f,d,v,p,y,g,b,m,S,A,x,k,O,q,C,P,H,L,E,T;return n(this,function(n){switch(n.label){case 0:return t=o.signingDate,a=void 0===t?new Date:t,l=o.expiresIn,h=void 0===l?3600:l,f=o.unsignableHeaders,d=o.unhoistableHeaders,v=o.signableHeaders,p=o.signingRegion,y=o.signingService,[4,this.credentialProvider()];case 1:return g=n.sent(),null==p?[3,2]:(m=p,[3,4]);case 2:return[4,this.regionProvider()];case 3:m=n.sent(),n.label=4;case 4:return b=m,S=K(a),A=S.longDate,x=S.shortDate,h>604800?[2,Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future")]:(k=j(x,b,null!=y?y:this.service),O=function(r,t){var n,o,a;void 0===t&&(t={});var s="function"==typeof r.clone?r.clone():z(r),u=s.headers,c=s.query,l=void 0===c?{}:c;try{for(var h=i(Object.keys(u)),f=h.next();!f.done;f=h.next()){var d=f.value,v=d.toLowerCase();"x-amz-"!==v.substr(0,6)||(null===(a=t.unhoistableHeaders)||void 0===a?void 0:a.has(v))||(l[d]=u[d],delete u[d])}}catch(e){n={error:e}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(n)throw n.error}}return e(e({},r),{headers:u,query:l})}(I(r),{unhoistableHeaders:d}),g.sessionToken&&(O.query[c]=g.sessionToken),O.query["X-Amz-Algorithm"]=w,O.query["X-Amz-Credential"]=g.accessKeyId+"/"+k,O.query[s]=A,O.query["X-Amz-Expires"]=h.toString(10),q=D(O,f,v),O.query["X-Amz-SignedHeaders"]=X(q),C=O.query,P=u,H=this.getSignature,L=[A,k,this.getSigningKey(g,b,x,y)],E=this.createCanonicalRequest,T=[O,q],[4,R(r,this.sha256)]);case 5:return[4,H.apply(this,L.concat([E.apply(this,T.concat([n.sent()]))]))];case 6:return C[P]=n.sent(),[2,O]}})})},r.prototype.sign=function(e,r){return t(this,void 0,void 0,function(){return n(this,function(t){return"string"==typeof e?[2,this.signString(e,r)]:e.headers&&e.payload?[2,this.signEvent(e,r)]:[2,this.signRequest(e,r)]})})},r.prototype.signEvent=function(e,r){var i=e.headers,o=e.payload,a=r.signingDate,s=void 0===a?new Date:a,u=r.priorSignature,c=r.signingRegion,l=r.signingService;return t(this,void 0,void 0,function(){var e,r,t,a,h,f,d,v,p,y,g;return n(this,function(n){switch(n.label){case 0:return null==c?[3,1]:(r=c,[3,3]);case 1:return[4,this.regionProvider()];case 2:r=n.sent(),n.label=3;case 3:return e=r,t=K(s),a=t.shortDate,h=t.longDate,f=j(a,e,null!=l?l:this.service),[4,R({headers:{},body:o},this.sha256)];case 4:return d=n.sent(),(v=new this.sha256).update(i),y=P,[4,v.digest()];case 5:return p=y.apply(void 0,[n.sent()]),g=[m,h,f,u,p,d].join("\n"),[2,this.signString(g,{signingDate:s,signingRegion:e,signingService:l})]}})})},r.prototype.signString=function(e,r){var i=void 0===r?{}:r,o=i.signingDate,a=void 0===o?new Date:o,s=i.signingRegion,u=i.signingService;return t(this,void 0,void 0,function(){var r,t,i,o,c,l,h,f;return n(this,function(n){switch(n.label){case 0:return[4,this.credentialProvider()];case 1:return r=n.sent(),null==s?[3,2]:(i=s,[3,4]);case 2:return[4,this.regionProvider()];case 3:i=n.sent(),n.label=4;case 4:return t=i,o=K(a).shortDate,h=(l=this.sha256).bind,[4,this.getSigningKey(r,t,o,u)];case 5:return(c=new(h.apply(l,[void 0,n.sent()]))).update(e),f=P,[4,c.digest()];case 6:return[2,f.apply(void 0,[n.sent()])]}})})},r.prototype.signRequest=function(e,r){var o=void 0===r?{}:r,a=o.signingDate,s=void 0===a?new Date:a,u=o.signableHeaders,c=o.unsignableHeaders,f=o.signingRegion,d=o.signingService;return t(this,void 0,void 0,function(){var r,t,o,a,y,g,b,m,S,A,x;return n(this,function(n){switch(n.label){case 0:return[4,this.credentialProvider()];case 1:return r=n.sent(),null==f?[3,2]:(o=f,[3,4]);case 2:return[4,this.regionProvider()];case 3:o=n.sent(),n.label=4;case 4:return t=o,a=I(e),y=K(s),g=y.longDate,b=y.shortDate,m=j(b,t,null!=d?d:this.service),a.headers[h]=g,r.sessionToken&&(a.headers[p]=r.sessionToken),[4,R(a,this.sha256)];case 5:return S=n.sent(),!function(e,r){var t,n;e=e.toLowerCase();try{for(var o=i(Object.keys(r)),a=o.next();!a.done;a=o.next())if(e===a.value.toLowerCase())return!0}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!1}(v,a.headers)&&this.applyChecksum&&(a.headers[v]=S),A=D(a,c,u),[4,this.getSignature(g,m,this.getSigningKey(r,t,b,d),this.createCanonicalRequest(a,A,S))];case 6:return x=n.sent(),a.headers[l]=w+" Credential="+r.accessKeyId+"/"+m+", SignedHeaders="+X(A)+", Signature="+x,[2,a]}})})},r.prototype.createCanonicalRequest=function(e,r,t){var n=Object.keys(r).sort();return e.method+"\n"+this.getCanonicalPath(e)+"\n"+function(e){var r,t,n=e.query,o=void 0===n?{}:n,a=[],s={},u=function(e){if(e.toLowerCase()===d)return"continue";a.push(e);var r=o[e];"string"==typeof r?s[e]=H(e)+"="+H(r):Array.isArray(r)&&(s[e]=r.slice(0).sort().reduce(function(r,t){return r.concat([H(e)+"="+H(t)])},[]).join("&"))};try{for(var c=i(Object.keys(o).sort()),l=c.next();!l.done;l=c.next())u(l.value)}catch(e){r={error:e}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(r)throw r.error}}return a.map(function(e){return s[e]}).filter(function(e){return e}).join("&")}(e)+"\n"+n.map(function(e){return e+":"+r[e]}).join("\n")+"\n\n"+n.join(";")+"\n"+t},r.prototype.createStringToSign=function(e,r,i){return t(this,void 0,void 0,function(){var t,o;return n(this,function(n){switch(n.label){case 0:return(t=new this.sha256).update(i),[4,t.digest()];case 1:return o=n.sent(),[2,w+"\n"+e+"\n"+r+"\n"+P(o)]}})})},r.prototype.getCanonicalPath=function(e){var r=e.path;return this.uriEscapePath?"/"+encodeURIComponent(r.replace(/^\//,"")).replace(/%2F/g,"/"):r},r.prototype.getSignature=function(e,r,i,o){return t(this,void 0,void 0,function(){var t,a,s,u,c;return n(this,function(n){switch(n.label){case 0:return[4,this.createStringToSign(e,r,o)];case 1:return t=n.sent(),u=(s=this.sha256).bind,[4,i];case 2:return(a=new(u.apply(s,[void 0,n.sent()]))).update(t),c=P,[4,a.digest()];case 3:return[2,c.apply(void 0,[n.sent()])]}})})},r.prototype.getSigningKey=function(e,r,t,n){return function(e,r,t,n,o){var a=t+":"+n+":"+o+":"+r.accessKeyId+":"+r.sessionToken;if(a in A)return A[a];for(x.push(a);x.length>50;)delete A[x.shift()];return A[a]=new Promise(function(s,u){var c,l,h=Promise.resolve("AWS4"+r.secretAccessKey),f=function(r){(h=h.then(function(t){return n=r,(i=new e(t)).update(n),i.digest();var n,i})).catch(function(){})};try{for(var d=i([t,n,o,S]),v=d.next();!v.done;v=d.next())f(v.value)}catch(e){c={error:e}}finally{try{v&&!v.done&&(l=d.return)&&l.call(d)}finally{if(c)throw c.error}}h.then(s,function(e){delete A[a],u(e)})})}(this.sha256,e,t,r,n||this.service)},r}(),K=function(e){var r,t=(r=e,function(e){return"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e}(r).toISOString().replace(/\.\d{3}Z$/,"Z")).replace(/[\-:]/g,"");return{longDate:t,shortDate:t.substr(0,8)}},X=function(e){return Object.keys(e).sort().join(";")},N=function(e){if("string"==typeof e){var r=Promise.resolve(e);return function(){return r}}return e},M=function(e){if("object"==typeof e){var r=Promise.resolve(e);return function(){return r}}return e},U=function(){function i(r){var t=e({service:r.signingName||r.service||"s3",uriEscapePath:r.uriEscapePath||!1},r);this.signer=new T(t)}return i.prototype.presign=function(i,o){void 0===o&&(o={});var a=o.unsignableHeaders,s=void 0===a?new Set:a,u=o.unhoistableHeaders,c=void 0===u?new Set:u,l=r(o,["unsignableHeaders","unhoistableHeaders"]);return t(this,void 0,void 0,function(){return n(this,function(r){return s.add("content-type"),Object.keys(i.headers).map(function(e){return e.toLowerCase()}).filter(function(e){return e.startsWith("x-amz-server-side-encryption")}).forEach(function(e){c.add(e)}),i.headers["X-Amz-Content-Sha256"]="UNSIGNED-PAYLOAD",[2,this.signer.presign(i,e({expiresIn:900,unsignableHeaders:s,unhoistableHeaders:c},l))]})})},i}(),B=function(){function r(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.substr(-1)?e.protocol+":":e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?"/"+e.path:e.path:"/"}return r.isInstance=function(e){if(!e)return!1;var r=e;return"method"in r&&"protocol"in r&&"hostname"in r&&"path"in r&&"object"==typeof r.query&&"object"==typeof r.headers},r.prototype.clone=function(){var t,n=new r(e(e({},this),{headers:e({},this.headers)}));return n.query&&(n.query=(t=n.query,Object.keys(t).reduce(function(r,n){var i,o=t[n];return e(e({},r),((i={})[n]=Array.isArray(o)?a(o):o,i))},{}))),n},r}();function G(e){var r=e.port,t=e.query,n=e.protocol,o=e.path,a=e.hostname;n&&":"!==n.substr(-1)&&(n+=":"),r&&(a+=":"+r),o&&"/"!==o.charAt(0)&&(o="/"+o);var s=t?function(e){var r,t,n=[];try{for(var o=i(Object.keys(e).sort()),a=o.next();!a.done;a=o.next()){var s=a.value,u=e[s];if(s=H(s),Array.isArray(u))for(var c=0,l=u.length;c<l;c++)n.push(s+"="+H(u[c]));else{var h=s;(u||"string"==typeof u)&&(h+="="+H(u)),n.push(h)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(r)throw r.error}}return n.join("&")}(t):"";return s&&"?"!==s[0]&&(s="?"+s),n+"//"+a+o+s}var W=function(r,i,o){return void 0===o&&(o={}),t(void 0,void 0,void 0,function(){var a,s,u,c;return n(this,function(l){switch(l.label){case 0:a=new U(e({},r.config)),s=function(r,i){return function(r){return t(void 0,void 0,void 0,function(){var t,s,u;return n(this,function(n){switch(n.label){case 0:if(t=r.request,!B.isInstance(t))throw new Error("Request to be presigned is not an valid HTTP request.");return delete t.headers["amz-sdk-invocation-id"],delete t.headers["amz-sdk-request"],[4,a.presign(t,e(e({},o),{signingRegion:null!==(s=o.signingRegion)&&void 0!==s?s:i.signing_region,signingService:null!==(u=o.signingService)&&void 0!==u?u:i.signing_service}))];case 1:return[2,{response:{},output:{$metadata:{httpStatusCode:200},presigned:n.sent()}}]}})})}},r.middlewareStack.addRelativeTo(s,{name:"presignInterceptMiddleware",relation:"before",toMiddleware:"awsAuthMiddleware"}),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,r.send(i)];case 2:return c=l.sent(),u=c.presigned,[3,4];case 3:return r.middlewareStack.remove("presignInterceptMiddleware"),[7];case 4:return[2,G(u)]}})})};export{U as S3RequestPresigner,W as getSignedUrl};